# 02_FUNCTIONAL_REQUIREMENTS

## Глоссарий:

| Термин                | Определение                                                                                     |
|-----------------------|------------------------------------------------------------------------------------------------|
| **Период**            | Отчетный временной интервал, в течение которого фиксируются метрики и достижения сотрудников.   |
| **Фонд премирования** | Общая сумма средств, выделяемая для выплаты премий в рамках одного отчетного периода.           |
| **Оценочный лист**    | Набор метрик и достижений, обязательных для заполнения сотрудником в определённом периоде.     |
| **Метрика**           | Эталонный показатель, обязательный к оценке; имеет диапазон баллов, формулировку и период.     |
| **Достижение**        | Факт выполнения/получения сотрудником определённого результата с подтверждением документацией.  |
| **Тип достижения**    | Шаблон для достижения, содержит описание, диапазон баллов и условия получения.                 |
| **Экземпляр достижения** | Конкретная запись о достижении, внесённая сотрудником за период.                            |
| **Статус достижения** | Текущее состояние экземпляра достижения (новое, на валидации, подтверждено, отклонено).        |
| **Руководитель**      | Пользователь, уполномоченный подтверждать достижения и метрики своих подчинённых.               |
| **Заместитель директора** | Роль с расширенными правами, без доступа к ключевым функциям директора.                   |
| **Администратор системы** | Пользователь с полным доступом ко всем функциям и журналу аудита.                         |
| **Архивация**         | Перевод периода в read-only-состояние, скрытое от обычных пользователей, доступно администрации.|
| **Журнал аудита**     | Лог действий пользователей: кто, когда и что изменил или подтвердил в системе.                  |


## 1. Описание функциональных модулей

### 1.1 Отчетные периоды
- Создание нового отчетного периода. Период виден только администрации;
- Указание стимулирующего фонда для периода;
- Запуск периода. Период становится видим всем сотрудникам;
- Завершение периода с блокировкой изменений;
- Архивация периода. Период пропадает у всех пользователей кроме администрации;
- Экспорт периода (экспорт всех метрик, достижений, вложений и результатов);
- Удаление периода с высвобождением занятого вложениями места.

### 1.2. Оценочные листы
- Администрация может создавать, редактировать и удалять оценочные листы
- Каждый оценочный лист содержит следующие поля:
  - Название листа
  - На какие должности распространяется лист
  - В каких отчетных периодах действует
  - Какие метрики содержит
  - Экземпляры достижений каких типов можно добавлять сотруднику, имеющему должность с этим оц.листом
- Редактировать оц.лист можно только тогда, когда он входит в период, который ещё не активен. Если активен или завершен, редактировать нельзя.
- Администрация может дублировать оценочные листы, чтобы вносить изменения и прикреплять к новым периодам

### 1.3 Метрики
- Добавление, редактирование и удаление метрик до запуска периода;
- Каждая метрика содержит:
    - название, описание;
    - диапазон веса (min/max);
    - период действия;
    - группы сотрудников, к которым она применяется.
- Метрики становятся неизменяемыми после начала периода.

### 1.4 Достижения
- Администрация может создавать, редактировать и удалять типы достижений
- Тип достижения абстрактен и содержит следующие поля:
    - имя типа достижения (например, "Грамота федерального уровня");
    - диапазон баллов (минимум и максимум);
    - текстовое описание условий получения максимума или минимума баллов;
- Сотрудник может добавлять экземпляр достижения, указав:
    - тип достижения;
    - обоснование (текст);
    - прикреплённый файл (до 10 МБ);
    - число баллов в пределах допустимого диапазона.
- После добавления достижение получает статус "на валидации";
- Руководитель видит достижения своих подчинённых;
- Возможность подтвердить или отклонить каждое достижение;
- Подтверждение переводит достижение в статус "подтверждено";
- Отклонение — в статус "отклонено";
- Комментарий при отклонении — опционален.

### 1.5 Расчёт премий
- Расчёт запускается администратором после завершения периода.
- Для каждого сотрудника рассчитывается:
    - сумма баллов;
    - доля от общего фонда;
    - итоговая премия.
- Баллы, фонд и результат фиксируются и становятся read-only.

### 1.6 Пользователи
- У администратора системы должна быть возможность добавлять, редактировать и удалять пользователей системы
- У учетной записи пользователя должны быть следующие обязательные поля:
  - Имя
  - Фамилия
  - Отчество
  - Логин в системе
  - Пароль
  - Должность
  - Подразделение
- Привязка руководителей к подчинённым (один к нескольким, и наоборот).

### 1.7 Должности
- У заместителей директора, директора и администратора системы должна быть возможность создавать, редактировать и удалять должности

### 1.8 Журналирование действий
- Все действия логируются:
    - создание и редактирование метрик;
    - добавление и изменение достижений;
    - подтверждение и отклонение;
    - завершение периода и расчёт премий.
- Журнал доступен администраторам и заместителям.

### 1.9 Просмотр и экспорт данных
- Доступ к информации ограничен ролью:
    - сотрудник — свои достижения;
    - руководитель — достижения подчинённых;
    - заместитель и администратор — все данные.
- Экспорт таблиц в Excel.
- PDF экспорт — только клиентский (через браузер).

## 2. Жизненный цикл сущностей

### 2.1 Метрика
- `на заполнение` → создаётся и редактируется.
- `заполнена` → фиксируется при старте периода, более не изменяется.

### 2.2 Достижение
- `новое` → создано сотрудником.
- `на валидации` → ожидает решения руководителя.
- `подтверждено` → зачтено и учитывается в премии.
- `отклонено` → не участвует в расчётах.

## 3. Ролевая модель
### 3.1. Роли в системе
- В системе должны быть предусмотрены следующие роли:
  - сотрудник
  - заместитель директора
  - директор
  - администратор системы.

### 3.2. Доступы ролей

| Доступ\Роль        |        Сотрудник         |        Заместитель        |                        Директор                        |     Администратор системы     |
|:------------------:|:------------------------:|:-------------------------:|:------------------------------------------------------:|:-----------------------------:|
| Просмотр пользователей | Только себя и подчиенных | Только себя и подчиенных  |                          Всех                          | Всех                         |
| Создание пользователей |            -             |             -             |                           -                            | Да                           |
| Редактирование пользователей |       Только себя        |    Только свой профиль    | Только свой профиль + Выстраивание иерархии подчинения | Всех                         |
| Удаление пользователей |            -             |             -             |                           -                            | Да (soft-delete)             |
| Смена пароля           |       Только себя        |             -             |                           -                            | Любому пользователю           |
| Управление ролями      |            -             |             -             |          Да, кроме роли Администратор сситемы          | Да                           |
| Назначение руководителей |            -             |            Да             |                           Да                           | Да                           |
| Просмотр оценочных листов |       Только свой        |        Подчинённых        |                          Всех                          | Всех                         |
| Изменение оценочных листов |       Только свой        | Подчинённых (ограниченно) |                          Всех                          | Всех                         |
| Просмотр метрик/достижений |       Только свои        |        Подчинённых        |                          Всех                          | Всех                         |
| Ввод/изменение метрик/достижений |       Только свои        |             -             |                          Всех                          | Всех                         |
| Согласование метрик/достижений |            -             |        Подчинённых        |                          Всех                          | Всех                         |
| Просмотр логов/аудита     |            -             |             -             |                           Да                           | Да (полный доступ)           |
| Экспорт данных           |           Нет            |             -             |                           Да                           | Да                           |
| Запуск периода           |            -             |             -             |                           Да                           | Да                           |
| Завершение периода       |            -             |             -             |                           Да                           | Да                           |
| Премиальный фонд (настройка/просмотр) |            -             |             -             |                           Да                           | Да                           |


## 3. Ограничения и проверки
- Достижение не может быть создано без файла.
- Вес достижения должен попадать в min/max метрики.
- Только руководитель может подтверждать достижения подчинённых.
- Изменения недоступны после завершения периода.
- Только директор может завершить период и инициировать расчёт.

## 4. Требования к интерфейсу

- Максимум 2–3 клика до любой ключевой функции.
- Термины должны быть однозначны: "метрика", "достижение", "период", "баллы", "премия".
- Интерфейс адаптируется под малые экраны.

## 5. Архитектура
### 5.1. Контекстная диаграмма
![context.png](../uml/c4_context.png)

### 5.2. Компонентная диаграмма
![component.png](../uml/c4_component.png)

### 5.3. Контейнерная диаграмма


### 5.4. Модель данных. Entity Relation Diagram
![erd.png](../uml/erd.png)

### 5.5. Требования к структуре данных:

1. Все идентификаторы сущностей — UUID (или другой уникальный тип).
2. Все поля с текстом (имя, описание, обоснование, комментарий) — ограничены по длине (например, 255/1024/2048 символов), поддерживают только валидный UTF-8.
3. Все поля email, логин — валидируются по шаблону, уникальность проверяется в системе.
4. Пароль хранится только в зашифрованном (BCrypt/SHA-256 и т.п.) виде, не менее 8 символов.
5. Файлы достижений:
  1. Допустимые типы: PDF, JPG, PNG, DOCX (другие только при явном расширении требований).
  2. Максимальный размер — 10 МБ.
6. Метрика/достижение не может быть изменена после наступления определённого статуса (read-only после валидации/завершения периода).
7. Все поля, влияющие на бизнес-логику (баллы, статусы, периоды) — должны быть защищены от прямого редактирования через UI (только валидированные формы).
8. Для всех действий, приводящих к изменению состояния сущности, обязательно сохранять дату и идентификатор пользователя (created_by, created_at, modified_by, modified_at).
9. Удаление реализовано как soft-delete (is_deleted=true), чтобы сохранять историю и связность данных.
10. Для каждой сущности должны быть определены обязательные и опциональные поля.


## 6. Сценарии ошибок и исключений:

Пользователь пытается добавить достижение вне открытого периода
— Ошибка: “В данный момент нельзя добавлять достижения. Нет открытого периода.”

Файл превышает максимальный размер или недопустимый тип
— Ошибка: “Файл должен быть не более 10 МБ и в формате PDF, JPG, PNG, DOCX.”

Вводимое число баллов вне допустимого диапазона метрики/достижения
— Ошибка: “Число баллов должно быть между {min} и {max}.”

Попытка редактировать метрику или достижение после блокировки
— Ошибка: “Редактирование недоступно. Метрика/достижение заблокировано после подтверждения или завершения периода.”

Попытка подтвердить достижение не руководителем
— Ошибка: “Только руководитель может подтверждать достижения подчинённых.”

Попытка завершить период при наличии неутверждённых метрик или достижений
— Ошибка: “Нельзя завершить период: не все достижения и метрики утверждены.”

Попытка удалить пользователя, к которому привязаны активные данные
— Ошибка: “Нельзя удалить пользователя: имеются связанные оценки или достижения.”

Попытка входа с неактивным или удалённым пользователем
— Ошибка: “Пользователь заблокирован или удалён.”

Ошибка валидации обязательных полей
— Ошибка: “Пожалуйста, заполните все обязательные поля.”

Внутренняя ошибка сервера, сбой загрузки файла, недоступность сервиса
— Ошибка: “Внутренняя ошибка системы. Попробуйте повторить позже или обратитесь к администратору.”
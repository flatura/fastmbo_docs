# Принятые архитектурные решения

---

## ADR-000. Архитектурный стиль: многослойный монолит

**Решение:**  
Система реализуется как монолитное многослойное приложение: контроллеры, сервисы, репозитории, модели данных, шаблоны.  
**Причина:**  
Быстрая разработка, простое развертывание, минимальные инфраструктурные требования. MVP и pet-проект.

---

## ADR-001. Архитектурный паттерн: MVC

**Решение:**  
Используется классический паттерн Model-View-Controller (MVC) на базе Spring Boot и Thymeleaf.  
**Причина:**  
Строгое разделение бизнес-логики, представления и данных. Прозрачная поддержка CRUD-операций.

---

## ADR-002. Технологический стек: Spring Boot

**Решение:**  
Spring Boot 2.6.x (актуальная стабильная версия на начало 2022 года), Spring Security, Spring Data JPA, Thymeleaf, Bootstrap 5.  
**Причина:**  
Зрелость экосистемы, устойчивость, поддержка best practice, простота интеграции.

---

## ADR-003. Минимализм UI

**Решение:**  
Фронтенд на Thymeleaf с серверной генерацией HTML, Bootstrap 5 без jQuery, таблицы через DataTables/Tabulator (open source edition).  
**Причина:**  
Минимизация зависимостей, лёгкость сопровождения, простота портирования, фокус на бэкенде.

---

## ADR-004. Ролевая модель (RBAC) — статическая

**Решение:**  
Фиксированные роли: Пользователь, Руководитель/Заместитель, Директор, Администратор системы.  
Права задаются на уровне кода, без внешней настройки и таблицы ролей.  
**Причина:**  
Прозрачная логика доступа, быстрое внедрение, отсутствие избыточности.

---

## ADR-005. Модули и блочная структура

**Решение:**  
Система декомпозирована на независимые бизнес-блоки: Users, Groups, Positions, Metrics, Achievements, PerformanceLists, Periods, Reports, Audit, Attachments.  
**Причина:**  
Облегчение поддержки и расширения, чистота архитектуры, снижение связанности.

---

## ADR-006. Фильтрация, поиск, валидация

**Решение:**  
Встроенные фильтры (если поддерживаются библиотекой таблиц), live-поиск (2-50 символов), валидация и экранирование на сервере и клиенте, обязательная защита от SQL-инъекций и XSS.  
**Причина:**  
Удобство, безопасность, предотвращение злоупотреблений.

---

## ADR-007. Пагинация и ограничения по объёму

**Решение:**  
Таблицы ≤ 1000 строк — без пагинации; >1000 — пагинация обязательна, page size 100-200. Логи — всегда с пагинацией.  
**Причина:**  
Сохранение отзывчивости, предотвращение перегрузки UI/сервера.

---

## ADR-008. Денормализация fact-таблиц

**Решение:**  
Дублирование ключевых ссылок в таблицах фактов (period_id, performance_list_id, user_id, type_id, значения); snapshot критичных параметров допускается.  
**Причина:**  
Независимость фактов от reference-таблиц, поддержка историчности и аудита.

---

## ADR-009. Хранение файлов (attachments)

**Решение:**  
По умолчанию файлы хранятся в локальной файловой системе сервера (например, /data/files/attachments/). Возможность миграции на MinIO/S3 или сетевое хранилище закладывается в архитектуру. В БД фиксируется путь/ключ к файлу и (опционально) отдельная ссылка на превью (thumbnail), если реализовано.  
**Причина:**  
Лёгкость развёртывания для малого масштаба, готовность к масштабированию и миграции на объектное хранилище.

---

## ADR-010. Документирование и аудит

**Решение:**  
Все архитектурные решения, бизнес-правила, критические изменения фиксируются в ADR и Markdown-документации (docs-as-code, docs/ADR/).  
**Причина:**  
Трассируемость, воспроизводимость решений, поддержка портфолио и собеседований.

---

## ADR-011. Нефункциональные требования

**Решение:**  
Поддержка до 1000 пользователей, до 700 одновременно активных; хранение вложений — до 100 ГБ за 10 лет; отсутствие интеграции с внешними сервисами на старте; доступ только из корпоративной сети; резервное копирование БД и вложений.  
**Причина:**  
Пропорциональность масштабу и сценарию внедрения, минимизация затрат на инфраструктуру.

---

## ADR-012. Масштабируемость и расширяемость

**Решение:**  
Система проектируется stateless: при необходимости допускается горизонтальное масштабирование (несколько экземпляров монолита за балансировщиком, единое файловое/объектное хранилище, общая БД).  
**Причина:**  
Готовность к росту числа пользователей, без жёсткой привязки к одному серверу.

---

## ADR-013. Возможность миграции в SaaS/облако

**Решение:**  
В архитектуре заложена возможность поддержки multi-tenancy, разделения данных по организациям, интеграции с платёжными шлюзами и облачным объектным хранилищем, масштабирования через Kubernetes/Docker при необходимости.  
**Причина:**  
Потенциал для коммерческого облачного запуска, экспансии за пределы одного учреждения.

---

